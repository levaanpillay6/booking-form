<script src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script>
  (function(){
    emailjs.init("  7TFonS4xrwEod_pTz   "); // Replace with your EmailJS public key
  })();

  const form = document.getElementById("bookingForm");
  form.addEventListener("submit", async e => {
    e.preventDefault();

    const data = {
      name: name.value,
      number: number.value,
      email: email.value,
      wing: wing.value,
      event: event.value,
      date: date.value,
      from: from.value,
      to: to.value,
      sound: sound.checked ? "Yes" : "No"
    };

    // 1️⃣ Send email via EmailJS
    try {
      await emailjs.send("service_uzyihin", "template_qwerty123", data); 
      console.log("Email sent via EmailJS");
    } catch(err) {
      console.error("EmailJS error:", err);
      alert("Email could not be sent.");
      return;
    }

    // 2️⃣ Send data to Apps Script for Sheet + Calendar
    try {
      const res = await fetch(
        "https://script.google.com/macros/s/AKfycbwJWqAlLh416ivy8YoNzra1VweFOGdKoZrZu4bbOlrSjLsfhMEACd1xciCshMsqKRqBAg/exec",
        {
          method: "POST",
          body: JSON.stringify(data)
        }
      );

      const result = await res.json();
      if(result.status === "conflict"){
        alert("⚠️ This time slot is already booked.");
        return;
      }

      formSection.style.display = "none";
      noteSection.style.display = "block";
    } catch(err){
      console.error("Apps Script error:", err);
      alert("Submission to Sheet/Calendar failed.");
    }
  });
</script>
